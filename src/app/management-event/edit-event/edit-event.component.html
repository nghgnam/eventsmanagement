<h3>Edit Event</h3>

@if (successMessage || errorMessage) {
  <div class="notification">
    @if (successMessage) {
      <div class="success">{{ successMessage }}</div>
    }
    @if (errorMessage) {
      <div class="error">{{ errorMessage }}</div>
    }
  </div>
}

<form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
  <div class="form-row">
    <div class="form-group">
      <label for="name">Event Name *</label>
      <div class="input-with-icon">
        <input type="text" id="name" formControlName="name" placeholder="Enter event name">
      </div>
      @if (eventForm.get('name')?.touched && eventForm.get('name')?.errors?.['required']) {
        <div class="error-message">
          Event name is required
        </div>
      }
      @if (eventForm.get('name')?.touched && eventForm.get('name')?.errors?.['minlength']) {
        <div class="error-message">
          Event name must be at least 3 characters
        </div>
      }
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="description">Description *</label>
      <div class="input-with-icon">
        <textarea id="description" formControlName="description" placeholder="Enter event description"></textarea>
      </div>
      @if (eventForm.get('description')?.touched && eventForm.get('description')?.errors?.['required']) {
        <div class="error-message">
          Description is required
        </div>
      }
      @if (eventForm.get('description')?.touched && eventForm.get('description')?.errors?.['minlength']) {
        <div class="error-message">
          Description must be at least 10 characters
        </div>
      }
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="content">Content *</label>
      <div class="input-with-icon">
        <textarea id="content" formControlName="content" placeholder="Enter event content"></textarea>
      </div>
      @if (eventForm.get('content')?.touched && eventForm.get('content')?.errors?.['required']) {
        <div class="error-message">
          Content is required
        </div>
      }
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="startDate">Start Date *</label>
      <div class="input-with-icon">
        <input type="datetime-local" id="startDate" formControlName="startDate">
      </div>
      @if (eventForm.get('startDate')?.touched && eventForm.get('startDate')?.errors?.['required']) {
        <div class="error-message">
          Start date is required
        </div>
      }
    </div>
    <div class="form-group">
      <label for="endDate">End Date *</label>
      <div class="input-with-icon">
        <input type="datetime-local" id="endDate" formControlName="endDate">
      </div>
      @if (eventForm.get('endDate')?.touched && eventForm.get('endDate')?.errors?.['required']) {
        <div class="error-message">
          End date is required
        </div>
      }
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="eventType">Event Type *</label>
      <div class="input-with-icon">
        <select id="eventType" formControlName="eventType">
          <option value="offline">Offline</option>
          <option value="online">Online</option>
          <option value="hybrid">Hybrid</option>
        </select>
      </div>
      @if (eventForm.get('eventType')?.touched && eventForm.get('eventType')?.errors?.['required']) {
        <div class="error-message">
          Event type is required
        </div>
      }
    </div>
  </div>

  @if (isOffline || isHybrid) {
    <div class="form-group">
      <label for="details_address">Address *</label>
      <div class="input-with-icon">
        <i class="fa-solid fa-house input-icon"></i>
        <input type="text" id="details_address" formControlName="details_address" placeholder="Enter event address">
      </div>
      @if (eventForm.get('details_address')?.touched && eventForm.get('details_address')?.errors?.['required']) {
        <div class="error-message">
          Address is required for offline/hybrid events
        </div>
      }
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="districts">Districts *</label>
        <div class="input-with-icon">
          <i class="fa-solid fa-city input-icon"></i>
          <select id="districts" formControlName="districts">
            <option [ngValue]="null">Select a district</option>
            @for (districtOption of districtsWithCities; track districtOption.code) {
              <option [ngValue]="districtOption">
                {{ districtOption.name }}
              </option>
            }
          </select>
        </div>
        @if (eventForm.get('districts')?.touched && eventForm.get('districts')?.errors?.['required']) {
          <div class="error-message">
            District is required
          </div>
        }
      </div>

      <div class="form-group">
        <label for="wards">Wards *</label>
        <div class="input-with-icon">
          <i class="fa-solid fa-earth-asia input-icon"></i>
          <select id="wards" formControlName="wards">
            <option [ngValue]="null">Select a ward</option>
            @for (wardOption of wardsWithDistricts; track wardOption.code) {
              <option [ngValue]="wardOption">
                {{ wardOption.name }}
              </option>
            }
          </select>
        </div>
        @if (eventForm.get('wards')?.touched && eventForm.get('wards')?.errors?.['required']) {
          <div class="error-message">
            Ward is required
          </div>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="country">Country *</label>
        <div class="input-with-icon">
          <i class="fa-solid fa-earth-asia input-icon"></i>
          <select id="country" formControlName="country">
            <option value="">Select a country</option>
            @for (countryOption of countries; track countryOption.name) {
              <option [value]="countryOption.name">
                {{ countryOption.name }}
              </option>
            }
          </select>
        </div>
        @if (eventForm.get('country')?.touched && eventForm.get('country')?.errors?.['required']) {
          <div class="error-message">
            Country is required
          </div>
        }
      </div>

      <div class="form-group">
        <label for="city">City *</label>
        <div class="input-with-icon">
          <i class="fa-solid fa-city input-icon"></i>
          <select id="city" formControlName="city">
            <option [ngValue]="null">Select a city</option>
            @for (cityOption of citiesValue; track cityOption.code) {
              <option [ngValue]="cityOption">
                {{ cityOption.name }}
              </option>
            }
          </select>
        </div>
        @if (eventForm.get('city')?.touched && eventForm.get('city')?.errors?.['required']) {
          <div class="error-message">
            City is required
          </div>
        }
      </div>
    </div>
  }

  <div class="form-row">
    <div class="form-group">
      <label for="price">Price</label>
      <div class="input-with-icon">
        <input type="number" id="price" formControlName="price" min="0" step="0.01" placeholder="Enter event price">
      </div>
      @if (eventForm.get('price')?.touched && eventForm.get('price')?.errors?.['min']) {
        <div class="error-message">
          Price cannot be negative
        </div>
      }
    </div>
    <div class="form-group">
      <label for="maxAttendees">Max Attendees</label>
      <div class="input-with-icon">
        <input type="number" id="maxAttendees" formControlName="maxAttendees" min="1" placeholder="Enter maximum attendees">
      </div>
      @if (eventForm.get('maxAttendees')?.touched && eventForm.get('maxAttendees')?.errors?.['min']) {
        <div class="error-message">
          Maximum attendees must be at least 1
        </div>
      }
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="tags">Tags (comma separated)</label>
      <div class="input-with-icon">
        <input type="text" id="tags" formControlName="tags" placeholder="e.g., Business, Technology">
      </div>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="image">Event Image</label>
      <div class="image-upload-container">
        @if (imagePreviewUrl) {
          <div class="image-preview">
            <img [src]="imagePreviewUrl" alt="Event image preview">
            <button type="button" class="remove-image" (click)="removeImage()">
              X
            </button>
          </div>
        }
        @if (!imagePreviewUrl) {
          <div class="image-upload-area" (click)="triggerImageUpload()">
            <p>Click to upload image</p>
            <p class="image-hint">Recommended: 1200x630px, max 5MB</p>
          </div>
        }
        <input type="file" id="image" (change)="onImageSelected($event)" accept="image/*" class="hidden-input">
      </div>
      @if (imageError) {
        <div class="error-message">
          {{imageError}}
        </div>
      }
    </div>
  </div>

  <div class="form-actions">
    <button type="button" class="btn-secondary" (click)="router.navigate(['/events'])">
      Cancel
    </button>
    <button type="submit" class="btn-primary" [disabled]="!eventForm.valid || isLoading">
      {{isLoading ? 'Saving...' : 'Save Changes'}}
    </button>
  </div>
</form>