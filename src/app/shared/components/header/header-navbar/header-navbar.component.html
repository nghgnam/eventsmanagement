<nav class="header_navbar">
  <div class="header_navbar_left">
    <div class="header_navbar_menu" [class.mobile-open]="mobileMenuOpen" [class.mobile-hide]="!mobileMenuOpen && isMobile">
      @if (!isLoggedIn) {
        <a routerLink="/contact-sales" class="header_navbar_link">Explore</a>
        <a routerLink="/find-tickets" class="header_navbar_link">Categories</a>
        <a routerLink="/contact-sales" class="header_navbar_link">Contact Sales</a>
      } @else {
        <a routerLink="/contact-sales" class="header_navbar_link">Explore</a>
        <a routerLink="/create-event" class="header_navbar_link">Create Event</a>
        <a routerLink="/find-tickets" class="header_navbar_link">Categories</a>
        <a routerLink="/contact-sales" class="header_navbar_link">Contact Sales</a>
      }
      <!-- <a class="header_navbar_link" >Help</a> -->
    </div>
    <button class="header_navbar_hamburger" (click)="toggleMobileMenu()" aria-label="Toggle menu">
      <span class="hamburger-icon">&#9776;</span>
    </button>
  </div>

  <div class="header_navbar_center">
    <app-header-search></app-header-search>
  </div>

  <div class="header_navbar_right">
    @if (isLoggedIn) {
      <div class="header_navbar_notifications">
        <button
          type="button"
          class="notification-bell"
          (click)="toggleNotifications()"
          aria-label="Notifications"
        >
          <span class="bell-icon">
            üîî
          </span>
          @if (unreadCount > 0) {
            <span class="badge">{{ unreadCount }}</span>
          }
        </button>

        @if (isNotificationsOpen) {
          <div class="notifications-panel">
            <div class="panel-header">
              <span>Th√¥ng b√°o</span>
              <span class="panel-subtitle">C·∫≠p nh·∫≠t m·ªõi nh·∫•t v·ªÅ s·ª± ki·ªán c·ªßa b·∫°n</span>
            </div>

            <div class="panel-section">
              <div class="section-title">Nh·∫Øc nh·ªü s·ª± ki·ªán</div>
              @for (item of notifications; track item.id) {
                @if (item.type === 'reminder') {
                  <div class="notification-item reminder">
                    <div class="item-icon">‚è∞</div>
                    <div class="item-content">
                      <div class="item-title">{{ item.title }}</div>
                      <div class="item-message">{{ item.message }}</div>
                      <div class="item-time">{{ item.time }}</div>
                    </div>
                  </div>
                }
              }
            </div>

            <div class="panel-section">
              <div class="section-title">Organizer b·∫°n theo d√µi</div>
              @for (item of notifications; track item.id) {
                @if (item.type === 'organizer') {
                  <div class="notification-item organizer">
                    <div class="item-icon">‚≠ê</div>
                    <div class="item-content">
                      <div class="item-title">{{ item.title }}</div>
                      <div class="item-message">{{ item.message }}</div>
                      <div class="item-time">{{ item.time }}</div>
                    </div>
                  </div>
                }
              }
            </div>

            <div class="panel-section">
              <div class="section-title">Thay ƒë·ªïi / h·ªßy s·ª± ki·ªán</div>
              @for (item of notifications; track item.id) {
                @if (item.type === 'change') {
                  <div class="notification-item change">
                    <div class="item-icon">üìç</div>
                    <div class="item-content">
                      <div class="item-title">{{ item.title }}</div>
                      <div class="item-message">{{ item.message }}</div>
                      <div class="item-time">{{ item.time }}</div>
                    </div>
                  </div>
                }
              }
            </div>

            <div class="panel-footer">
              <a routerLink="/my-tickets" class="panel-link">
                Xem v√© v√† s·ª± ki·ªán c·ªßa t√¥i
              </a>
            </div>
          </div>
        }
      </div>
    }
    @if (isLoggedIn) {
      <div class="header_navbar_user_group" (mouseenter)="showDropdown(true)" (mouseleave)="showDropdown(false)">
        @if (sanitizeImageUrl(userCurrentImage); as safeUrl) {
          <img [src]="safeUrl" class="header_navbar_avatar" alt="Avatar" />
        }
        <span class="header_navbar_username">{{ userCurrentname || userCurrentEmail }}</span>
        <div class="header_navbar_state">
          <div class="user_dropdown_menu" [class.show_dropdown_menu]="isDropdownOpen">
            <div class="options_menu" (click)="goToManageEvent()">Manage Events</div>
            <div class="options_menu" (click)="goToTicketsManage()">Tickets</div>
            <div class="options_menu" (click)="goToFollowing()">Following</div>
            <div class="options_menu border_line" (click)="goToAccountSetting()">Account settings</div>
            <a class="header_navbar_logout" (click)="onSignOut()"> 
              LOGOUT
              <i class="fa-solid fa-right-from-bracket header_navbar_logout_icon"></i>
            </a>
          </div>
        </div>
      </div>
    }
    
    @if (!checkingForLogin) {
      <a class="header_navbar_sign_up" [routerLink]="['/register']" (click)="onNavigate()">
          SIGN UP
      </a>
      <a class="header_navbar_login" [routerLink]="['/login']" (click)="onNavigate()">
          LOGIN
          <i class="fa-solid fa-right-to-bracket header_navbar_login_icon"></i>
      </a>
    }
  </div>
</nav>
